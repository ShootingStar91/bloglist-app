(this["webpackJsonpbloglist-frontend"]=this["webpackJsonpbloglist-frontend"]||[]).push([[0],{18:function(e,t,n){},42:function(e,t,n){"use strict";n.r(t);var r,c=n(1),o=(n(18),n(16)),i=n.n(o),s=n(4),a=n.n(s),u=n(6),l=n(2),d=n(0),j=function(e){var t=e.blog,n=e.likeButtonClicked,r=e.deleteButtonClicked,o=Object(c.useState)(!1),i=Object(l.a)(o,2),s=i[0],a=i[1];return s?Object(d.jsxs)("div",{style:{paddingTop:6,paddingLeft:2,border:"solid",borderWidth:1,marginBottom:6},"data-cy":"blog-root",children:[Object(d.jsxs)("div",{children:[Object(d.jsx)("b",{children:"Title: "})," ",t.title," ",Object(d.jsx)("button",{onClick:function(){return a(!1)},children:"Hide"})]}),Object(d.jsxs)("div",{children:[Object(d.jsx)("b",{children:"Author:"})," ",t.author]}),Object(d.jsxs)("div",{children:[Object(d.jsx)("b",{children:"Url:   "})," ",t.url]}),Object(d.jsxs)("div",{children:[Object(d.jsx)("b",{children:"Likes: "})," ",t.likes," ",Object(d.jsx)("button",{"data-cy":"like-button",onClick:function(){n(t),t.likes+=1},children:"Like"})]}),t.user?Object(d.jsxs)("div",{children:[Object(d.jsx)("b",{children:"Added by:"})," ",t.user.name]}):Object(d.jsxs)("div",{children:[Object(d.jsx)("b",{children:"Added by:"})," Data missing."]}),Object(d.jsx)("div",{children:Object(d.jsx)("button",{"data-cy":"delete-button",onClick:function(){r(t)},children:"Remove"})})]}):Object(d.jsxs)("div",{children:[t.title," ",t.author," ",Object(d.jsx)("button",{"data-cy":"show-button",onClick:function(){return a(!0)},children:"Show"})]})},b=function(e){var t=e.postBlog,n=Object(c.useState)(""),r=Object(l.a)(n,2),o=r[0],i=r[1],s=Object(c.useState)(""),a=Object(l.a)(s,2),u=a[0],j=a[1],b=Object(c.useState)(""),h=Object(l.a)(b,2),g=h[0],O=h[1];return Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{children:"Add a new blog"}),Object(d.jsxs)("form",{onSubmit:function(e){e.preventDefault(),t(o,u,g)},children:[Object(d.jsxs)("p",{children:["Title: ",Object(d.jsx)("input",{id:"title",onChange:function(e){i(e.target.value)}})]}),Object(d.jsxs)("p",{children:["Author: ",Object(d.jsx)("input",{id:"author",onChange:function(e){j(e.target.value)}})]}),Object(d.jsxs)("p",{children:["Url: ",Object(d.jsx)("input",{id:"url",onChange:function(e){O(e.target.value)}})]}),Object(d.jsx)("p",{children:Object(d.jsx)("button",{id:"post-blog-button",type:"submit",children:"Post blog"})})]})]})},h=n(5),g=n.n(h),O="/api/blogs",f={getAll:function(){return g.a.get(O).then((function(e){return e.data}))},setToken:function(e){r="bearer "+e},postBlog:function(e,t,n){return g.a.post(O,{title:e,author:t,url:n},{headers:{Authorization:r}}).then((function(e){return e.data}))},likeBlog:function(e,t){return g.a.put(O+"/"+e,{likes:t+1}).then((function(e){return e.data}))},deleteBlog:function(e){return g.a.delete(O+"/"+e,{headers:{Authorization:r}}).then((function(e){return e.data}))}},p={tryLogin:function(e,t){return console.log("Trying login with ",e," ",t),g.a.post("/api/login",{username:e,password:t}).then((function(t){return{username:e,token:t.data.token,name:t.data.name}}))}},x=function(e){var t=e.message;return null===t||""===t?null:Object(d.jsx)("div",{id:"error-notification",className:"error",children:t})},v=function(e){var t=e.message;return null===t||""===t?null:Object(d.jsx)("div",{id:"success-notification",className:"success",children:t})},k=function(e){return Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{children:"Login to bloglist app"}),Object(d.jsxs)("form",{onSubmit:e.tryLogin,children:[Object(d.jsxs)("p",{children:["Username ",Object(d.jsx)("input",{id:"username",onChange:e.handleUsernameChange})]}),Object(d.jsxs)("p",{children:["Password ",Object(d.jsx)("input",{id:"password",type:"password",onChange:e.handlePasswordChange})]}),Object(d.jsx)("p",{children:Object(d.jsx)("button",{id:"login-button",type:"submit",children:"Log in"})})]})]})},m=function(){var e=Object(c.useState)([]),t=Object(l.a)(e,2),n=t[0],r=t[1],o=Object(c.useState)(""),i=Object(l.a)(o,2),s=i[0],h=i[1],g=Object(c.useState)(""),O=Object(l.a)(g,2),m=O[0],w=O[1],y=Object(c.useState)(null),C=Object(l.a)(y,2),S=C[0],B=C[1],L=Object(c.useState)(""),A=Object(l.a)(L,2),T=A[0],U=A[1],E=Object(c.useState)(""),I=Object(l.a)(E,2),N=I[0],P=I[1],J=Object(c.useState)(!1),D=Object(l.a)(J,2),z=D[0],q=D[1],H=function(e){U(e),setTimeout((function(){U("")}),5e3)},R=function(e){P(e),setTimeout((function(){P("")}),5e3)},W=function(){f.getAll().then((function(e){e.sort((function(e,t){return e.likes>t.likes?-1:e.likes<t.likes?1:0})),r(e)}))};Object(c.useEffect)((function(){W()}),[]),Object(c.useEffect)((function(){var e=window.localStorage.getItem("loggedUser");if(e){var t=JSON.parse(e);B(t),f.setToken(t.token)}}),[]);var F=function(){var e=Object(u.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),console.log("Attempting to log in..."),e.prev=2,e.next=5,p.tryLogin(s,m);case 5:n=e.sent,f.setToken(n.token),B(n),window.localStorage.setItem("loggedUser",JSON.stringify(n)),R("Login successful"),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),H("Login failed");case 15:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t){return e.apply(this,arguments)}}(),G=function(){var e=Object(u.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.localStorage.removeItem("loggedUser"),B(null),R("Logged out.");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(e){h(e.target.value)},M=function(e){w(e.target.value)},Q=function(){var e=Object(u.a)(a.a.mark((function e(t,n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.postBlog(t,n,r);case 3:R("New blog posted successfully"),W(),q(!1),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),400===e.t0.response.status?H("Could not post blog. Title and url are required!"):401===e.t0.response.status?H("Invalid login token. Please logout and then login again."):H("Could not post blog. Error unknown.");case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n,r){return e.apply(this,arguments)}}(),V=function(e){try{f.likeBlog(e.id,e.likes),W(),R("Liked blog")}catch(t){H("Error with like button"),console.log(t.response)}},X=function(){var e=Object(u.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.confirm("Are you sure you want to delete: "+t.title)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,f.deleteBlog(t.id);case 5:W(),R("Blog deleted"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),H("Error with deleting blog");case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}();return Object(d.jsxs)("div",{children:[Object(d.jsx)(x,{message:T}),Object(d.jsx)(v,{message:N}),null===S?Object(d.jsx)(k,{tryLogin:F,handleUsernameChange:K,handlePasswordChange:M}):Object(d.jsxs)("div",{children:[Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{children:"Blogs"}),Object(d.jsxs)("p",{children:[S.name," is logged in. ",Object(d.jsx)("button",{id:"logout-button",onClick:G,children:"Logout"})]}),n.map((function(e){return Object(d.jsx)(j,{blog:e,likeButtonClicked:V,deleteButtonClicked:X},e.id)}))]}),z?Object(d.jsxs)("div",{children:[Object(d.jsx)(b,{postBlog:Q}),Object(d.jsx)("p",{children:Object(d.jsx)("button",{onClick:function(){return q(!1)},children:"Cancel"})})]}):Object(d.jsxs)("div",{children:[Object(d.jsx)("br",{}),Object(d.jsx)("br",{}),Object(d.jsx)("button",{id:"show-blog-form-button",onClick:function(){return q(!0)},children:"Add new blog"})]})]})]})};i.a.render(Object(d.jsx)(m,{}),document.getElementById("root"))}},[[42,1,2]]]);
//# sourceMappingURL=main.740ea0eb.chunk.js.map