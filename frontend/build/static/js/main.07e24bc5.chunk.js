(this["webpackJsonpbloglist-frontend"]=this["webpackJsonpbloglist-frontend"]||[]).push([[0],{19:function(e,t,n){},43:function(e,t,n){"use strict";n.r(t);var c,r=n(1),o=(n(19),n(17)),i=n.n(o),s=n(4),a=n(6),u=n(2),l=n(0),d=function(e){var t=e.blog,n=e.likeButtonClicked,c=e.deleteButtonClicked,o=Object(r.useState)(!1),i=Object(u.a)(o,2),s=i[0],a=i[1];return s?Object(l.jsxs)("div",{style:{paddingTop:6,paddingLeft:2,border:"solid",borderWidth:1,marginBottom:6},"data-cy":"blog-root",children:[Object(l.jsxs)("div",{children:[Object(l.jsx)("b",{children:"Title: "})," ",t.title," ",Object(l.jsx)("button",{onClick:function(){return a(!1)},children:"Hide"})]}),Object(l.jsxs)("div",{children:[Object(l.jsx)("b",{children:"Author:"})," ",t.author]}),Object(l.jsxs)("div",{children:[Object(l.jsx)("b",{children:"Url:   "})," ",t.url]}),Object(l.jsxs)("div",{children:[Object(l.jsx)("b",{children:"Likes: "})," ",t.likes," ",Object(l.jsx)("button",{"data-cy":"like-button",onClick:function(){n(t),t.likes+=1},children:"Like"})]}),t.user?Object(l.jsxs)("div",{children:[Object(l.jsx)("b",{children:"Added by:"})," ",t.user.name]}):Object(l.jsxs)("div",{children:[Object(l.jsx)("b",{children:"Added by:"})," Data missing."]}),Object(l.jsx)("div",{children:Object(l.jsx)("button",{"data-cy":"delete-button",onClick:function(){c(t)},children:"Remove"})})]}):Object(l.jsxs)("div",{children:[t.title," ",t.author," ",Object(l.jsx)("button",{"data-cy":"show-button",onClick:function(){return a(!0)},children:"Show"})]})},j=function(e){var t=e.postBlog,n=Object(r.useState)(""),c=Object(u.a)(n,2),o=c[0],i=c[1],s=Object(r.useState)(""),a=Object(u.a)(s,2),d=a[0],j=a[1],b=Object(r.useState)(""),h=Object(u.a)(b,2),O=h[0],g=h[1];return Object(l.jsxs)("div",{children:[Object(l.jsx)("h2",{children:"Add a new blog"}),Object(l.jsxs)("form",{onSubmit:function(e){e.preventDefault(),t(o,d,O)},children:[Object(l.jsxs)("p",{children:["Title: ",Object(l.jsx)("input",{id:"title",onChange:function(e){i(e.target.value)}})]}),Object(l.jsxs)("p",{children:["Author: ",Object(l.jsx)("input",{id:"author",onChange:function(e){j(e.target.value)}})]}),Object(l.jsxs)("p",{children:["Url: ",Object(l.jsx)("input",{id:"url",onChange:function(e){g(e.target.value)}})]}),Object(l.jsx)("p",{children:Object(l.jsx)("button",{id:"post-blog-button",type:"submit",children:"Post blog"})})]})]})},b=n(5),h=n.n(b),O="/api/blogs",g={getAll:function(){return h.a.get(O).then((function(e){return e.data}))},setToken:function(e){c="bearer "+e},postBlog:function(e,t,n){return h.a.post(O,{title:e,author:t,url:n},{headers:{Authorization:c}}).then((function(e){return e.data}))},likeBlog:function(e,t){return h.a.put(O+"/"+e,{likes:t+1}).then((function(e){return e.data}))},deleteBlog:function(e){return h.a.delete(O+"/"+e,{headers:{Authorization:c}}).then((function(e){return e.data}))}},f={tryLogin:function(e,t){return console.log("Trying login with ",e," ",t),h.a.post("/api/login",{username:e,password:t}).then((function(t){return{username:e,token:t.data.token,name:t.data.name}}))}},p=function(e){var t=e.message;return null===t||""===t?null:Object(l.jsx)("div",{id:"error-notification",className:"error",children:t})},x=function(e){var t=e.message;return null===t||""===t?null:Object(l.jsx)("div",{id:"success-notification",className:"success",children:t})},v=function(e){return Object(l.jsxs)("div",{children:[Object(l.jsx)("h2",{children:"Login to bloglist app"}),Object(l.jsxs)("form",{onSubmit:e.tryLogin,children:[Object(l.jsxs)("p",{children:["Username ",Object(l.jsx)("input",{id:"username",onChange:e.handleUsernameChange})]}),Object(l.jsxs)("p",{children:["Password ",Object(l.jsx)("input",{id:"password",type:"password",onChange:e.handlePasswordChange})]}),Object(l.jsx)("p",{children:Object(l.jsx)("button",{id:"login-button",type:"submit",children:"Log in"})})]})]})},k=function(){var e=Object(r.useState)([]),t=Object(u.a)(e,2),n=t[0],c=t[1],o=Object(r.useState)(""),i=Object(u.a)(o,2),b=i[0],h=i[1],O=Object(r.useState)(""),k=Object(u.a)(O,2),m=k[0],w=k[1],y=Object(r.useState)(null),C=Object(u.a)(y,2),S=C[0],B=C[1],L=Object(r.useState)(""),A=Object(u.a)(L,2),T=A[0],U=A[1],E=Object(r.useState)(""),I=Object(u.a)(E,2),N=I[0],P=I[1],J=Object(r.useState)(!1),D=Object(u.a)(J,2),z=D[0],q=D[1],H=function(e){U(e),setTimeout((function(){U("")}),5e3)},R=function(e){P(e),setTimeout((function(){P("")}),5e3)},W=function(){g.getAll().then((function(e){e.sort((function(e,t){return e.likes>t.likes?-1:e.likes<t.likes?1:0})),c(e)}))};Object(r.useEffect)((function(){W()}),[]),Object(r.useEffect)((function(){var e=window.localStorage.getItem("loggedUser");if(e){var t=JSON.parse(e);B(t),g.setToken(t.token)}}),[]);var F=function(){var e=Object(a.a)(Object(s.a)().mark((function e(t){var n;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),console.log("Attempting to log in..."),e.prev=2,e.next=5,f.tryLogin(b,m);case 5:n=e.sent,g.setToken(n.token),B(n),window.localStorage.setItem("loggedUser",JSON.stringify(n)),R("Login successful"),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),H("Login failed");case 15:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t){return e.apply(this,arguments)}}(),G=function(){var e=Object(a.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.localStorage.removeItem("loggedUser"),B(null),R("Logged out.");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(e){h(e.target.value)},M=function(e){w(e.target.value)},Q=function(){var e=Object(a.a)(Object(s.a)().mark((function e(t,n,c){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.postBlog(t,n,c);case 3:R("New blog posted successfully"),W(),q(!1),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),400===e.t0.response.status?H("Could not post blog. Title and url are required!"):401===e.t0.response.status?H("Invalid login token. Please logout and then login again."):H("Could not post blog. Error unknown.");case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n,c){return e.apply(this,arguments)}}(),V=function(e){try{g.likeBlog(e.id,e.likes),W(),R("Liked blog")}catch(t){H("Error with like button"),console.log(t.response)}},X=function(){var e=Object(a.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.confirm("Are you sure you want to delete: "+t.title)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,g.deleteBlog(t.id);case 5:W(),R("Blog deleted"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),H("Error with deleting blog");case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}();return Object(l.jsxs)("div",{children:[Object(l.jsx)(p,{message:T}),Object(l.jsx)(x,{message:N}),null===S?Object(l.jsx)(v,{tryLogin:F,handleUsernameChange:K,handlePasswordChange:M}):Object(l.jsxs)("div",{children:[Object(l.jsxs)("div",{children:[Object(l.jsx)("h2",{children:"Blogs"}),Object(l.jsxs)("p",{children:[S.name," is logged in. ",Object(l.jsx)("button",{id:"logout-button",onClick:G,children:"Logout"})]}),n.map((function(e){return Object(l.jsx)(d,{blog:e,likeButtonClicked:V,deleteButtonClicked:X},e.id)}))]}),z?Object(l.jsxs)("div",{children:[Object(l.jsx)(j,{postBlog:Q}),Object(l.jsx)("p",{children:Object(l.jsx)("button",{onClick:function(){return q(!1)},children:"Cancel"})})]}):Object(l.jsxs)("div",{children:[Object(l.jsx)("br",{}),Object(l.jsx)("br",{}),Object(l.jsx)("button",{id:"show-blog-form-button",onClick:function(){return q(!0)},children:"Add new blog"})]})]})]})};i.a.render(Object(l.jsx)(k,{}),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.07e24bc5.chunk.js.map